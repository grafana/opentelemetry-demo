---
kind: pipeline
type: docker
name: docker-push

trigger:
  event:
    include:
    - push

steps:
- name: docker-test-1
  image: plugins/docker
  settings:
    dockerfile: ./src/frontend/Dockerfile
    repo: cerebralnoodle/otel-faro-demo
    daemon_off: true
    tags: latest
    context: ./src/frontend/
    password:
      from_secret: docker_password
    username:
      from_secret: docker_username
- name: docker-test-2
  image: plugins/docker
  settings:
    dockerfile: ./src/frontend/Dockerfile
    repo: cerebralnoodle/otel-faro-demo
    dry_run: true
    tags: latest
    context: ./src/frontend/
    password:
      from_secret: docker_password
    username:
      from_secret: docker_username

---
kind: secret
name: gcp_key

get:
    name: gcp_key
    path: infra/data/ci/drone-plugins
---
kind: secret
name: gh_token

get:
  name: pat
  path: infra/data/ci/github/grafanabot
---
get:
  name: username
  path: infra/data/ci/docker_hub
kind: secret
name: docker_username
---
get:
  name: password
  path: infra/data/ci/docker_hub
kind: secret
name: docker_password
---
kind: secret
name: dockerconfigjson

get:
  path: secret/data/common/gcr
  name: .dockerconfigjson

---
kind: signature
hmac: d3e47cc0d4c1ebb19c0be77f19cd9eb4d350970f8de7de146da85ebf3393d934

...
